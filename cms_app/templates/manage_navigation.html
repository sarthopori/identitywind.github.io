{% extends "base.html" %}
{% block title %}Manage Navigation{% endblock %}

{% block content %}
<div class="cms-container">
    <h2>Manage Navigation Menu</h2>
    <p>Drag and drop items to reorder them. Click "Save Changes" to update labels, URLs, and the order. Use the arrows for fine-tuning the order.</p>

    <form method="POST" action="{{ url_for('update_all_nav_items') }}">
        <div id="navigation-list">
            {% for item in navigation %}
            <div class="nav-item">
                <div class="drag-handle">☰</div>
                <div class="nav-inputs">
                    <input type="text" name="label" value="{{ item.label }}" placeholder="Label (e.g., Home)">
                    <input type="text" name="url" value="{{ item.url }}" placeholder="URL (e.g., /index.html)">
                    <input type="text" name="id" value="{{ item.id }}" placeholder="Page ID (e.g., index)">
                </div>
                <div class="nav-actions">
                    <button formaction="{{ url_for('move_nav_item', item_id=loop.index0, direction='up') }}" class="btn-move">↑</button>
                    <button formaction="{{ url_for('move_nav_item', item_id=loop.index0, direction='down') }}" class="btn-move">↓</button>
                    <button formaction="{{ url_for('delete_nav_item', item_id=loop.index0) }}" class="btn-delete-sm" onclick="return confirm('Are you sure you want to delete this item?');">×</button>
                </div>
            </div>
            {% endfor %}
        </div>
        <button type="submit" class="btn-submit">Save All Changes</button>
    </form>

    <hr class="form-divider">

    <h3>Add New Navigation Item</h3>
    <form method="POST" action="{{ url_for('add_nav_item') }}" class="add-new-form">
        <div class="form-group">
            <label for="label">Label:</label>
            <input type="text" id="label" name="label" required placeholder="Text to display">
        </div>
        <div class="form-group">
            <label for="url">URL:</label>
            <input type="text" id="url" name="url" required placeholder="/contact.html">
        </div>
        <div class="form-group">
            <label for="id">Page ID:</label>
            <input type="text" id="id" name="id" required placeholder="contact">
            <small>This must match the template's filename without '.html' to highlight the active page.</small>
        </div>
        <button type="submit" class="btn-add">Add Item to Menu</button>
    </form>
</div>

<!-- Some additional CSS and JS for this specific page -->
<style>
    #navigation-list { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
    .nav-item { display: flex; align-items: center; gap: 10px; background: #f9f9f9; padding: 10px; border-radius: 4px; border: 1px solid #ddd; }
    .drag-handle { cursor: grab; font-size: 1.2em; color: #aaa; }
    .nav-inputs { flex-grow: 1; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
    .nav-actions { display: flex; gap: 5px; }
    .btn-move, .btn-delete-sm { border: none; background-color: #eee; border-radius: 4px; cursor: pointer; padding: 5px 10px; font-weight: bold; }
    .btn-move:hover, .btn-delete-sm:hover { background-color: #ddd; }
    .btn-delete-sm { background-color: #ffebee; color: #c62828; }
    .form-divider { border: 0; height: 1px; background: #eee; margin: 30px 0; }
    .add-new-form { border: 2px dashed #ddd; padding: 20px; border-radius: 5px; margin-top: 20px; }
</style>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var el = document.getElementById('navigation-list');
        var sortable = Sortable.create(el, {
            handle: '.drag-handle',
            animation: 150,
        });
    });
</script>
{% endblock %}