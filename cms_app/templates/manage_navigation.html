{% extends "base.html" %}
{% block title %}Manage Navigation{% endblock %}

{% block content %}

<!-- Main Card for Editing and Reordering Existing Items -->
<div class="card">
    <div class="card-header">
        <h2>Edit Menu Items</h2>
    </div>
    <div class="card-body">
        <p style="margin-top:0; color: var(--text-secondary);">Drag and drop items to reorder, or use the arrows. Click "Save Order & Changes" to apply all updates.</p>
        <form method="POST" action="{{ url_for('update_all_nav_items') }}" id="manage-nav-form">
            <div id="navigation-list">
                {% for item in navigation %}
                <div class="nav-item">
                    <div class="drag-handle">☰</div>
                    <div class="nav-inputs">
                        <input type="text" name="label" value="{{ item.label }}" placeholder="Label (e.g., Home)">
                        <input type="text" name="url" value="{{ item.url }}" placeholder="URL (e.g., /index.html)">
                        <input type="text" name="id" value="{{ item.id }}" placeholder="Page ID (e.g., index)">
                    </div>
                    <!-- The buttons below now submit the main form -->
                    <div class="nav-actions">
                        <button type="submit" formaction="{{ url_for('move_nav_item', item_id=loop.index0, direction='up') }}" class="btn-move" title="Move Up">↑</button>
                        <button type="submit" formaction="{{ url_for('move_nav_item', item_id=loop.index0, direction='down') }}" class="btn-move" title="Move Down">↓</button>
                        <button type="submit" formaction="{{ url_for('delete_nav_item', item_id=loop.index0) }}" class="btn-delete-sm" title="Delete" onclick="return confirm('Delete this item?');">×</button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </form>
    </div>
    <div class="card-footer">
        <!-- This button submits the form with id="manage-nav-form" -->
        <button type="submit" form="manage-nav-form" class="btn btn-primary">Save Order & Changes</button>
    </div>
</div>

<!-- Second Card for Adding a New Item -->
<div class="card">
    <div class="card-header">
        <h2>Add New Menu Item</h2>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('add_nav_item') }}">
            <div class="form-group">
                <label for="label">Label</label>
                <input type="text" id="label" name="label" required placeholder="Text to display">
            </div>
            <div class="form-group">
                <label for="url">URL</label>
                <input type="text" id="url" name="url" required placeholder="/contact.html">
            </div>
            <div class="form-group">
                <label for="id">Page ID</label>
                <input type="text" id="id" name="id" required placeholder="contact">
                <small>Must match the template's filename (e.g., 'contact' for contact.html) to highlight the active page.</small>
            </div>
            <div style="text-align: right;">
                <button type="submit" class="btn btn-primary">Add Item to Menu</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}


{% block scripts %}
<!-- Scripts specific to this page -->
<style>
    /* Styles are now scoped here to avoid cluttering base.html */
    #navigation-list { display: flex; flex-direction: column; gap: 10px; }
    .nav-item { 
        display: flex; align-items: center; gap: 10px; background: #fdfdfd; 
        padding: 10px; border-radius: 6px; border: 1px solid var(--border-color);
    }
    .drag-handle { cursor: grab; font-size: 1.2em; color: #94a3b8; padding: 0 10px; }
    .nav-inputs { flex-grow: 1; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .nav-actions { display: flex; gap: 5px; }
    .btn-move, .btn-delete-sm { 
        border: 1px solid var(--border-color); background-color: var(--card-bg); border-radius: 6px; 
        cursor: pointer; padding: 5px 10px; font-weight: bold; font-size: 1rem; color: var(--text-secondary);
        transition: all 0.2s;
    }
    .btn-move:hover { background-color: #f1f5f9; border-color: #cbd5e1; }
    .btn-delete-sm { background-color: #fee2e2; border-color: #fca5a5; color: var(--danger-color); }
    .btn-delete-sm:hover { background-color: var(--danger-color); color: white; }
</style>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var el = document.getElementById('navigation-list');
        if(el) {
            Sortable.create(el, {
                handle: '.drag-handle',
                animation: 150,
            });
        }
    });
</script>
{% endblock %}